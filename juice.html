<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Fruit Sales Inventory Management System</title>
    <style>
       body {
            margin: 0;
            font-family: Arial, Helvetica, sans-serif;
        }

        #sidebar {
            height: 100%;
            width: 0;
            position: fixed;
            z-index: 1;
            top: 0;
            left: 0;
            background-color: #111;
            overflow-x: hidden;
            transition: 0.5s;
            padding-top: 60px;
        }

        #sidebar a {
            padding: 8px 8px 8px 32px;
            text-decoration: none;
            font-size: 25px;
            color: #818181;
            display: block;
            transition: 0.3s;
        }

        #sidebar a:hover {
            color: #f1f1f1;
        }

        #sidebar .closebtn {
            position: absolute;
            top: 0;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
        }

        #sidebarToggle {
            font-size: 30px;
            cursor: pointer;
        }

        #main {
            transition: margin-left .5s;
            padding: 16px;
        }

        table {
            width: 100%;
            margin-top: 20px;
        }

        th, td {
            padding: 10px;
            text-align: center;
        }

        th {
            background-color: #333;
            color: white;
        }

        tbody {
            display: block;
            height: 300px; /* Adjust as needed */
            overflow-y: auto;
        }

        table thead, table tbody tr {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        tbody tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        tbody tr:nth-child(odd) {
            background-color: #ffffff;
        }

        .output {
            max-height: 200px;
            overflow-y: auto;
        }

    </style>
</head>

<body>

    <div id="sidebar">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
        <a href="index.html"id="Dashboardlink">Dashboard</a>
        <a href="fruit.html" id="fruitLink">fruit</a>
        <a href="juice.html" id="juiceLink">juice</a>
        <a href="expence.html" id="expenceLink">expence</a>
        <a href="sales.html" id="salesLink">sales</a>
    </div>
  <div id="main">
    <button id="sidebarToggle" onclick="openNav()">☰</button>
    <div id="main">
        <div class="top-container">
        <section id="rawMaterialSection" class="card">
            <h2>Raw Materials</h2>
            <form id="rawMaterialForm">
                <label for="rawMaterialName">Material Name:</label>
                <input type="text" id="rawMaterialName" required>
                <label for="rawMaterialQuantity">Quantity:</label>
                <input type="number" step="0.01" id="rawMaterialQuantity" required>
                <label for="rawMaterialprice">price:</label>
                <input type="number" step="0.01" id="rawMaterialprice" required>
                <button type="submit" onclick="addRawMaterial()">Add Raw Material</button>
            </form>
        </section>

        <section id="salesSection" class="card">
            <h2>Sales</h2>
            <form id="sellItemForm">
                <label for="sellItemId">Select Item:</label>
                <select id="sellItemId">
                    <option value="" disabled selected hidden>Select a the combinations</option>
                </select>      
                <label for="maxQuantity">available Quantity:</label>
                <input type="number" id="maxQuantity" readonly>
                <label for="sellQuantity">Quantity:</label>
                <input type="number" id="sellQuantity" required>  
                <button type="submit" onclick="sellItem()">Sell Item</button>
            </form>
        </section>

        <!-- Modified Losses Section -->
        <section id="lossesSection" class="card">
            <h2>Losses Management</h2>
            <form id="recordLossForm">
                <label for="lossItemId">Select Item:</label>
                <select id="lossItemId">
                    <option value="" disabled selected hidden>Select a raw material</option>
                </select>
                <label for="avalQuantity">available Quantity:</label>
                <input type="number" id="avalQuantity" readonly>
                <label for="lossQuantity">Quantity:</label>
                <input type="number" id="lossQuantity" required>
                <label for="lossReason">Reason:</label>
                <input type="text" id="lossReason" required>
                <button type="submit"onclick="recordLoss()">Record Loss</button>
            </form>
        </section>
        </div>
        <section id="combinationtable" class="card">
            <table id="combinationTable">
                <thead>
                    <tr>
                        <th>combination name</th>
                        <th>Row Materials</th>
                        <th>Row Materials Quantity</th>
                        <th>row materials selling price</th>
                    </tr>
                </thead>
                <tbody id="combinationTablebody">
                    <!-- Raw material rows will be dynamically added here -->
                </tbody>
            </table>
        </section>

        <section id="combinationSection" class="card">
            <h2>Combinations</h2>
            <form id="combinationForm">
                <label for="combinationName">Combination Name:</label>
                <input type="text" id="combinationName" required>
                <label for="rowItemId">Select row material:</label>
                <select id="rowItemId">
                    <option value="" disabled selected hidden>Select a raw material</option>
                </select>
                <label for="rowavailableQuantity">Selected available row material quantity:</label>
                <input type="text" id="rowavailableQuantity" readonly>
                <label for="rowstockprice">Selected row matrial stock price:</label>
                <input type="number" step="0.01" id="rowstockprice" readonly>
                <label for="rowquantity">input row-material quantity:</label>
                <input type="number" step="0.01" id="rowquantity" >
                <label for="rowsellingprice">input row-material selling price:</label>
                <input type="number" step="0.01" id="rowsellingprice" >
                <button type="submit" onclick="addCombination()">Add Combination</button>
            </form>
             
            <table id="rawMaterialTable">
                <thead>
                    <tr>
                        <th>combination name</th>
                        <th>Row id</th>
                        <th>Row Material</th>
                        <th>Quantity</th>
                        <th>price</th>
                    </tr>
                </thead>
                <tbody id="rawMaterialTableBody" style="height: 0; overflow-y: auto;">
                    <!-- Raw material rows will be dynamically added here -->
                </tbody>
            </table>
            <button type="button" onclick="submitCombination()">Submit Combination</button> <!-- New button -->
        </section>
        

        <section id="inventorySection" class="card">
            <h2>Inventory</h2>
            <table id="inventoryTable">
                <thead>
                    <tr>
                        <th>Material ID</th>
                        <th>Material Name</th>
                        <th>Quantity</th>
                        <th>price</th>
                        <th>total</th>
                    </tr>
                </thead>
                <tbody id="inventoryTableBody"></tbody>
            </table>
        </section>

        <section id="salesAndLossesSection" class="card">
            <h2>Sales and Losses Log</h2>
            <table id="salesAndLossesTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Action</th>
                        <th>Item Name</th>
                        <th>Quantity</th>
                        <th>Reason</th>
                        <th>selling price</th>
                    </tr>
                </thead>
                <tbody id="salesAndLossesTableBody"></tbody>
            </table>
        </section>
    </div>

    </div>  
    <script>
        // Get the current page filename (e.g., "fruit.html")
        var currentPage = location.pathname.split("/").slice(-1)[0];

        // Function to set the background color and disable the link for the current page
        function setCurrentPageStyle() {
            var navLinks = document.querySelectorAll("#sidebar a");

            // Reset styles for all links
            navLinks.forEach(function (link) {
                link.style.backgroundColor = "";
                link.style.pointerEvents = "auto";
            });

            // Set styles for the current page
            if (currentPage === "juice.html") {
                document.getElementById("juiceLink").style.backgroundColor = "green";
                document.getElementById("juiceLink").style.pointerEvents = "none"; // Disable the link
            }
        }

        // Call the function on page load
        setCurrentPageStyle();

        function openNav() {
            document.getElementById("sidebar").style.width = "250px";
            document.getElementById("main").style.marginLeft = "250px";
        }

        function closeNav() {
            document.getElementById("sidebar").style.width = "0";
            document.getElementById("main").style.marginLeft = "0";
        }
       
        document.addEventListener("DOMContentLoaded", function () {
            loadInventory();
            displayInventory();
            displaySalesAndLosses();
            loadCombinations();
            loadLossesDropdown();
            displaycombinations();

        // Update the available quantity when the selected option changes
        document.getElementById('lossItemId').addEventListener('change', updateAvalQuantity);
        });

        function addRawMaterial() {

            var itemName = document.getElementById('rawMaterialName').value;
            var quantity = document.getElementById('rawMaterialQuantity').value;
            var price = document.getElementById('rawMaterialprice').value;
             // Check if any of the inputs are empty
            if (!itemName || !quantity || !price) {
                console.log("Inputs cannot be empty.");
                return; // Exit the function
            }else{
                sendData('addRawMaterial', { itemName, quantity, price }, function () {
                displayInventory();
            });

            console.log("add item called ended");
            }
            
        }
        function sendData(section, data, callback) {
    console.log('Sending data:', data);

    var xhr = new XMLHttpRequest();
    xhr.open('POST', 'test.php', true);

    // Set the content type to application/x-www-form-urlencoded
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

    xhr.onreadystatechange = function () {
        if (xhr.readyState == 4) {
            console.log('Response:', xhr.responseText);
            if (xhr.status == 200) {
                try {
                    var responseData = JSON.parse(xhr.responseText);
                    console.log('Parsed Response:', responseData);
                    alert('Server Response: ' + xhr.responseText); // Display server response
                    // Check if handleResponse function exists before calling it
                    if (typeof handleResponse === 'function') {
                        handleResponse(section);
                    }
                    if (typeof callback === 'function') {
                        callback(responseData);
                    }
                } catch (error) {
                    console.error('Error parsing JSON:', error);
                    alert('Error parsing JSON');
                }
            } else {
                console.error('Request failed with status:', xhr.status);
                alert('Request failed with status: ' + xhr.status);
            }
        }
    };

    // Convert the data object to a URL-encoded string
    var encodedData = encodeData(data);

    xhr.send(encodedData);
}

function handleResponse(section) {
    // You can customize this function based on your needs
    console.log(`Response for section '${section}' handled.`);
    alert(`Response for section '${section}' handled.`);
}

        function encodeData(data) {
            return Object.keys(data).map(function (key) {
                return encodeURIComponent(key) + '=' + encodeURIComponent(data[key]);
            }).join('&');
        }

        function loadCombinations() {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'get_combinations.php', true);

            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var responseData = JSON.parse(xhr.responseText);
                    console.log('Received data:', responseData); // Log the received data
                    var select = document.getElementById('sellItemId');
                    select.innerHTML = ""; // Clear the select options
                    for (var i = 0; i < responseData.length; i++) {
                        var opt = document.createElement('option');
                        opt.value = responseData[i].id; // Set the value to the id
                        opt.innerHTML = responseData[i].name; // Set the innerHTML to the name
                        opt.setAttribute('availableQuantity', responseData[i].maxQuantity); // Set the availableQuantity attribute
                        select.appendChild(opt);
                    }
                    updateMaxQuantity(); // Update the max quantity for the initially selected option
                }
            };

            xhr.send();
        }

        function updateMaxQuantity() {
            var select = document.getElementById('sellItemId');
            var input = document.getElementById('maxQuantity'); // Assuming you have an input element with id 'maxQuantity'
            var selectedOption = select.options[select.selectedIndex];
            var maxQuantity = selectedOption.getAttribute('availableQuantity');
            input.value = maxQuantity;
        }
        // Update the max quantity when the selected option changes
        document.getElementById('sellItemId').addEventListener('change', updateMaxQuantity);

        function sellItem() {
            console.log("sell");
            
            var combinationId = document.getElementById('sellItemId').value;
            var quantity = document.getElementById('sellQuantity').value;
            var maxq = document.getElementById('maxQuantity').value;
            console.log(combinationId+quantity);
            if (!combinationId || !quantity || !maxq ) {
                alert("Inputs cannot be empty.");
                return; // Exit the function
            } else if (quantity > maxq) {
                alert('The quantity being inserted is greater than the available quantity.');
                return; // Exit the function
            } else {
                console.log('trying:');
                var data = {
                    combinationId: combinationId,
                    quantity: quantity
                };
                console.log('Sending data:', data);
                sendDatas('sellItem', data, function (responseData) {
                    // Handle the server's response
                    console.log("Server response:", responseData);
                    // Perform additional actions based on the response
                });
            }

        }

    function sendDatas(section, data, callback) {
        console.log('Sending data:', data);

        var xhr = new XMLHttpRequest();
        xhr.open('POST', 'get_combinations.php', true);

        xhr.setRequestHeader('Content-Type', 'application/json');

        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4) {
                console.log('Response:', xhr.responseText);
                if (xhr.status == 200) {
                    try {
                        var responseData = JSON.parse(xhr.responseText);
                        console.log('Parsed Response:', responseData);
                        if (typeof handleResponse === 'function') {
                            handleResponses(section);
                        }
                        if (typeof callback === 'function') {
                            callback(responseData);
                        }
                    } catch (error) {
                        console.log('Error parsing JSON:', error);
                        alert('Error parsing JSON');
                    }
                } else {
                    console.log('Request failed with status:', xhr.status);
                    alert('Request failed with status: ' + xhr.status);
                }
            }
        };

        var jsonData = JSON.stringify(data);

        xhr.send(jsonData);
    }
/////////////////////////////////////////////////////
// Define the loadLossesDropdown function first

function loadLossesDropdown() {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', 'get_losses.php', true);

    xhr.onreadystatechange = function () {
        if (xhr.readyState == 4 && xhr.status == 200) {
            var responseData = JSON.parse(xhr.responseText);

            // Check if responseData is an array
            if (Array.isArray(responseData)) {
                var select = document.getElementById('lossItemId');
                select.innerHTML = ""; // Clear the select options

                for (var i = 0; i < responseData.length; i++) {
                    var opt = document.createElement('option');
                    opt.value = responseData[i].id;
                    opt.innerHTML = responseData[i].name;
                    opt.setAttribute('availableQ', responseData[i].quantity);
                    select.appendChild(opt);
                }

                // Update the available quantity for the initially selected option
                updateAvalQuantity();
            } else {
                console.error('Invalid response data:', responseData);
            }
        }
    };

    xhr.send();
}

function updateAvalQuantity() {
    var select = document.getElementById('lossItemId');
    var input = document.getElementById('avalQuantity');
    var selectedOption = select.options[select.selectedIndex];

    // Check if selectedOption is defined before accessing its attributes
    if (selectedOption) {
        var maxQuantity = selectedOption.getAttribute('availableQ');
        console.log('Max Quantity:', maxQuantity); // Log the max quantity
        input.value = maxQuantity;
    }
}

function recordLoss() {
    var rowid = document.getElementById('lossItemId').value;
    var quantity = document.getElementById('lossQuantity').value;
    var lossReason = document.getElementById('lossReason').value;
    var maxq = document.getElementById('avalQuantity').value;

    if (!rowid || !quantity || !lossReason || !maxq) {
        console.log("Inputs cannot be empty.");
        return; // Exit the function
    }

    if (maxq < quantity) {
        alert('The quantity being inserted is greater than the available quantity.');
        return; // Exit the function
    } else {
        console.log('trying:');
        var data = {
            rowid: rowid,
            quantity: quantity,
            lossReason: lossReason
        };
        console.log('Sending data:', data);
        sendDatal('lossitem', data, function (responseData) {
            // Handle the server's response
            console.log("Server response:", responseData);
            // Perform additional actions based on the response
            loadLossesDropdown(); // Reload the dropdown after recording the loss
        });
    }
}

function sendDatal(section, data, callback) {
    console.log('Sending data:', data);

    var xhr = new XMLHttpRequest();
    xhr.open('POST', 'get_losses.php', true);

    xhr.setRequestHeader('Content-Type', 'application/json');

    xhr.onreadystatechange = function () {
        if (xhr.readyState == 4) {
            console.log('Response Status:', xhr.status);
            console.log('Response Text:', xhr.responseText);

            if (xhr.status == 200) {
                // Parse and process the response data
                var responseData = JSON.parse(xhr.responseText);
                // Additional logic to populate the dropdown options
                callback(responseData);
            } else {
                // Handle error cases
                console.error('Error in AJAX request:', xhr.status);
            }
        }
    };

    var jsonData = JSON.stringify(data);
    xhr.send(jsonData);
}

/////////////////////////////////////////////////////

        // Assuming you have a function to fetch the inventory from the server
        function fetchInventory() {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'inventory.php', false); // Change this to the URL of your PHP file
            xhr.send();

            if (xhr.status == 200) {
                return JSON.parse(xhr.responseText);
            } else {
                console.error('Error fetching inventory:', xhr.status);
                return [];
            }
        }
        function loadInventory() {
            var select = document.getElementById('rowItemId');
            var inventory = fetchInventory().data;

            console.log('Inventory:', inventory);

            for (var i = 0; i < inventory.length; i++) {
                var option = document.createElement('option');
                option.value = inventory[i].id;
                option.text = inventory[i].name;
                select.appendChild(option);
            }
        }

        document.getElementById('rowItemId').addEventListener('change', function () {
            var selectedItem = this.value;
            var inventory = fetchInventory().data; // Access the 'data' property

            var selectedInventoryItem = inventory.find(function (item) {
                return item.id === selectedItem;
            });

            if (selectedInventoryItem) {
                document.getElementById('rowavailableQuantity').value = selectedInventoryItem.quantity;
                document.getElementById('rowstockprice').value = selectedInventoryItem.price;
            }
        });
        function addCombination() {
            var availableQuantity = parseFloat(document.getElementById('rowavailableQuantity').value);
            var quantity = parseFloat(document.getElementById('rowquantity').value);
            var combinationN = document.getElementById('combinationName').value;
            var rowsellingprice = parseFloat(document.getElementById('rowsellingprice').value);
            var rowstockprice = parseFloat(document.getElementById('rowstockprice').value);
            if (!availableQuantity || !quantity || !combinationN || !rowsellingprice ||!rowstockprice) {
                console.log("Inputs cannot be empty.");
                return; // Exit the function
            } else if (availableQuantity < quantity) {
                alert('The quantity being inserted is greater than the available quantity.');
                return; // Exit the function
            } else if (rowstockprice > rowsellingprice ) {
                alert('The price being inserted is less than the stock price.');
                return; // Exit the function
            }else {
                document.getElementById('combinationName').disabled = true;
                document.getElementById('combinationName').readOnly = true;
                var table = document.getElementById('rawMaterialTableBody');
                var row = table.insertRow();

                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);
                var cell4 = row.insertCell(3);
                var cell5 = row.insertCell(4);

                cell1.innerHTML = combinationN;
                cell2.innerHTML = document.getElementById('rowItemId').value;
                cell3.innerHTML = document.getElementById('rowItemId').options[document.getElementById('rowItemId').selectedIndex].text;
                cell4.innerHTML = quantity;
                cell5.innerHTML = document.getElementById('rowsellingprice').value;
                // Calculate the height of a row
                var rowHeight = row.offsetHeight;

                // Calculate the current height of the table body
                var currentHeight = table.offsetHeight;

                // Set the maximum height of the table body
                var maxHeight = 300;

                // Increase the height of the table body by the height of a row, but not beyond the maximum height
                if (currentHeight + rowHeight <= maxHeight) {
                    table.style.height = (currentHeight + rowHeight) + "px";
                }
                document.getElementById('rowItemId').selectedIndex = 0;
                document.getElementById('rowavailableQuantity').value = '';
                document.getElementById('rowquantity').value = '';
                document.getElementById('rowsellingprice').value = '';
                document.getElementById('rowstockprice').value = '';
                
            }
        }

        function submitCombination() {
            var cname = document.getElementById('combinationName').value;
            var table = document.getElementById('rawMaterialTable');
            var data = [];

            if (table.rows.length < 0) {
                return;
            }

            for (var i = 1, row; row = table.rows[i]; i++) {
                var name = row.cells[0].innerHTML;
                var rowid = row.cells[1].innerHTML;
                var rawMaterial = row.cells[2].innerHTML;
                var quantity = row.cells[3].innerHTML;
                var price = row.cells[4].innerHTML;

                data.push({
                    name: name,
                    rowid: rowid,
                    rawMaterial: rawMaterial,
                    quantity: quantity,
                    price:price
                });
            }

            sendDatac('addCombination', data, function () {
                clearCombinationForm();
                loadCombinations();
                displaycombinations();
            });

            document.getElementById('combinationName').disabled = false;
            document.getElementById('combinationName').readOnly = false;
        }

        function sendDatac(section, data, callback) {
            console.log('Sending data:', data);

            var xhr = new XMLHttpRequest();
            xhr.open('POST', 'inventory.php', true);

            xhr.setRequestHeader('Content-Type', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4) {
                    console.log('Response:', xhr.responseText);
                    if (xhr.status == 200) {
                        try {
                            var responseData = JSON.parse(xhr.responseText);
                            console.log('Parsed Response:', responseData);
                            if (typeof handleResponse === 'function') {
                                handleResponses(section);
                            }
                            if (typeof callback === 'function') {
                                callback(responseData);
                            }
                        } catch (error) {
                            console.error('Error parsing JSON:', error);
                            alert('Error parsing JSON');
                        }
                    } else {
                        console.error('Request failed with status:', xhr.status);
                        alert('Request failed with status: ' + xhr.status);
                    }
                }
            };

            var jsonData = JSON.stringify(data);

            xhr.send(jsonData);
        }

        function handleResponses(section) {
            console.log(`Response for section '${section}' handled.`);
        }


    // Function to clear the combination form after submitting data
    function clearCombinationForm() {
        document.getElementById('combinationName').value = '';
        document.getElementById('rowItemId').selectedIndex = 0;
        document.getElementById('rowavailableQuantity').value = '';
        document.getElementById('rowquantity').value = '';
        document.getElementById('rowsellingprice').value = '';
        document.getElementById('rowstockprice').value = '';
        // Clear the raw material table
        var table = document.getElementById('rawMaterialTableBody');
        while (table.firstChild) {
            table.removeChild(table.firstChild);
        }
    }
        // Send the table's data to the server when the submit button is clicked
        document.getElementById('combinationForm').addEventListener('submit', function(e) {
            e.preventDefault();

            var table = document.getElementById('rawMaterialTable');
            var data = [];

            // Loop through each row in the table
            for (var i = 1, row; row = table.rows[i]; i++) {
                // Get the raw material and quantity from the row
                var combinationN = row.cells[0].innerHTML;
                var rowid = row.cells[1].innerHTML;
                var rawMaterial = row.cells[2].innerHTML;
                var quantity = row.cells[3].innerHTML;

                data.push({
                    combinationN: combinationN,
                    rowid: rowid,
                    rawMaterial: rawMaterial,
                    quantity: quantity
                });
            }
        });
        function displaycombinations() {
        // Fetch combination data from the server/database
        fetchcombinationData().then(function (combinationData) {
            // Display combination data in the table
            var combinationTableBody = document.getElementById("combinationTablebody");
            clearTable(combinationTableBody);

            combinationData.forEach(function (item) {
                var row = combinationTableBody.insertRow();
                row.insertCell(0).textContent = item.name;
                row.insertCell(1).textContent = item.rawMaterial;
                row.insertCell(2).textContent = item.quantity;
                row.insertCell(3).textContent = item.price;
            });
        });
}

    function displayInventory() {
        // Fetch inventory data from the server/database
        fetchInventoryData().then(function (inventoryData) {
            // Display inventory data in the table
            var inventoryTableBody = document.getElementById("inventoryTableBody");
            clearTable(inventoryTableBody);

            inventoryData.forEach(function (item) {
                var row = inventoryTableBody.insertRow();
                row.insertCell(0).textContent = item.id;
                row.insertCell(1).textContent = item.name;
                row.insertCell(2).textContent = item.quantity;
                row.insertCell(3).textContent = item.price;
                row.insertCell(4).textContent = item.quantity*item.price;

            });
        });
    }
    function displaySalesAndLosses() {
        // Fetch sales and losses data from the server/database
        fetchSalesAndLossesData().then(function (data) {
            // Display sales and losses data in the table
            var salesAndLossesTableBody = document.getElementById("salesAndLossesTableBody");
            clearTable(salesAndLossesTableBody);

            data.forEach(function (entry) {
                var row = salesAndLossesTableBody.insertRow();
                row.insertCell(0).textContent = entry.date;
                row.insertCell(1).textContent = entry.action;
                row.insertCell(2).textContent = entry.item_name;
                row.insertCell(3).textContent = entry.quantity;
                row.insertCell(4).textContent = entry.reason;
                row.insertCell(5).textContent = entry.selling_price;
            });
        });
    }
    function clearTable(tableBody) {
        while (tableBody.firstChild) {
            tableBody.removeChild(tableBody.firstChild);
        }
    }
    function fetchcombinationData() {
        // Make an AJAX request to the server to fetch inventory data
        return fetchDataFromServer("getCombinationData", {});
    }

    function fetchInventoryData() {
        // Make an AJAX request to the server to fetch inventory data
        return fetchDataFromServer("getInventoryData", {});
    }

    function fetchSalesAndLossesData() {
        // Make an AJAX request to the server to fetch sales and losses data
        return fetchDataFromServer("getSalesAndLossesData", {});
    }
    
    function fetchData(url, options) {
        return fetch(url, options)
            .then((response) => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .catch((error) => {
                console.error("Fetch Error:", error);
                throw error; // re-throw the error to be caught by the next catch block
            });
    }
        
    function fetchDataFromServer(action, data) {
        // Make an AJAX request to the server
        return fetchData(`server.php?action=${action}`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
        });
    }
    </script>
</body>
</html>